<task id="TASK-0070">
<summary>Tune optional include handling to reduce DISCOVERY_INCLUDE_OPTIONAL_MISSING churn</summary>
<scope>
- Components: discovery.include parsing, diagnostic policy for -include/sinclude
- Scenarios: Git config.mak/config.mak.autogen, BusyBox optional .config/.kconfig.d and arch/$(ARCH)/Makefile
</scope>
<developer>
- Add heuristics to collapse repeated optional include warnings for the same path and to recognize generated config files as expected-absent when running conversion cold.
- Support sinclude-style directives and variable-substituted optional paths without promoting them to hard errors.
- Consider flag/option to silence known optional patterns (config.mak, *.autogen) while still surfacing unexpected optional misses.
- Ensure optional includes outside the source tree are normalized to POSIX paths for reporting.
</developer>
<qe>
- Extend regression coverage for optional includes with variable components (e.g., arch/$(ARCH)/Makefile) ensuring they warn at most once.
- Verify mandatory includes are unaffected and that optional suppression can be toggled in tests/config.
- Run discovery suites to confirm no loss of reporting fidelity.
</qe>
<reviewer>
- Check that optional include suppression is narrowly scoped and documented.
- Ensure variable handling does not mask real missing files inadvertently.
- Validate deterministic ordering of diagnostics remains.
</reviewer>
<tests>
- pytest tests/discovery/test_real_world_regressions.py::test_kbuild_autoconf_rule_misparsed_and_read_fails
- pytest -k optional_include
- Dry-run: gmake2cmake --source-dir <git clone> --dry-run --report -vv (verify optional include logs)
</tests>
</task>
