<task id="TASK-0022">
<summary>Handle pattern rule instantiation in IRBuilder.</summary>
<scope>
- Extend IRBuilder to instantiate pattern rules based on discovered prerequisites.
- Match % patterns against actual source files to generate concrete targets.
- Preserve pattern rule metadata for CMake file(GLOB) generation where appropriate.
- Handle multiple pattern matches with deterministic selection.
- Emit UnknownConstruct for complex patterns that can't be mapped.</scope>
<developer>
- Add pattern_instantiate function matching patterns to filesystem entries.
- Create concrete targets from pattern rules when sources exist.
- Map to CMake file(GLOB_RECURSE) for simple patterns, custom rules for complex.
- Track which patterns generated which targets for diagnostics.
- Handle %.o: %.c and %.o: %.cpp priority/selection correctly.</developer>
<qe>
- Test pattern instantiation with various source layouts.
- Verify correct target generation from patterns.
- Test precedence when multiple patterns match.
- Validate CMake output uses appropriate glob patterns.</qe>
<reviewer>
- Check pattern matching algorithm correctness.
- Verify no targets lost or duplicated.
- Ensure deterministic behavior with filesystem ordering.
- Validate UnknownConstruct generation for unmappable patterns.</reviewer>
<tests>
- Commands: `pytest -q tests/ir/test_pattern_instantiation.py`.</tests>
</task>