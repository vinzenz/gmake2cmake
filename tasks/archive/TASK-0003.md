<task id="TASK-0003">
<summary>Implement IRBuilder and CMakeEmitter; finalize CLIController end-to-end with diagnostics reporting, JSON output, namespaced linking, global config centralization, and optional packaging.</summary>
<scope>
- Components: IRBuilder, CMakeEmitter, DiagnosticsReporter integration; finalize CLI run pipeline to produce files or dry-run buffers.
- Add JSON report writing via DiagnosticsReporter in CLI.
- Implement ProjectGlobalConfig handling into IR and CMake emission (root-global module or include).
- Add namespace/alias creation for internal libs, interface/imported targets, and packaging mode (install/export/Config files).</scope>
<developer>
- Implement IR build logic, target grouping, flag mapping, dependency attachment, validation per spec; classify libraries as internal/external/imported using heuristics and ConfigModel overrides; generate alias names `Namespace::Name`.
- Implement emitter rendering root/subdir CMakeLists with dry-run toggle; emit ProjectGlobalConfig.cmake when globals exist; include alias/INTERFACE targets and use namespaced links; generate packaging outputs when with_packaging True; handle write failures.
- Wire CLI run to short-circuit on errors before emit; exit code via diagnostics.exit_code.
- Add integration fixtures using BuildFacts from evaluator tests; add end-to-end tests producing CMake text.</developer>
<qe>
- Integration tests for scenarios TS09, TS10, TS13, TS14, TS15, TS19, TS20, TS21, TS22, TS23, TS24, TS25; verify generated CMake content matches expectations and is deterministic.
- Negative tests: unwritable output dir -> ERROR; unknown target type -> ERROR; unmapped flags -> WARN preserved; missing namespace/alias mapping surfaces diagnostics.
- Validate JSON report file when --report set; packaging mode emits install/export/config/version files with namespace.</qe>
<reviewer>
- Check emit output paths relative and sorted; unknown flags pass-through.
- Ensure diagnostics aggregated once and no duplicate writes; global config centralized in root/module.
- Confirm exit codes correct with WARN-only vs ERROR; namespaced aliases used for internal links.</reviewer>
<tests>
- Commands: `ruff check . && pytest -q tests/ir tests/emitter tests/e2e`.
- Add golden-file assertions for generated CMakeLists, global config module, and packaging outputs.</tests>
</task>
