<task id="TASK-0066">
<summary>Stabilize recursive-make cycle handling (DISCOVERY_CYCLE)</summary>
<scope>
- Components: discovery.scan_includes recursive make traversal, diagnostics formatting
- Scenario: Git's t/Makefile ↔ t/perf/Makefile backedge via $(MAKE) -C perf and $(MAKE) -C .. test-lint
</scope>
<developer>
- Detect and surface cycles created by reciprocal -C invocations with clearer edge context (origin line, target dir).
- Avoid halting all content collection when a cycle is found; consider isolating only the cyclic subgraph while allowing other nodes to progress.
- Add de-duplication so the same two-node cycle is not reported twice.
- Evaluate whether recursive-make cycles should downgrade severity or include remediation hints (e.g., treat as non-fatal when targets are test harnesses).
- Keep logging stable and deterministic for repeated runs.
</developer>
<qe>
- Add regression covering perf↔parent recursion using $(MAKE) -C perf / $(MAKE) -C .. (see new fixture).
- Verify cycles still block conversion where required but do not suppress unrelated files.
- Ensure diagnostics capture both endpoints and annotate the triggering lines.
</qe>
<reviewer>
- Confirm cycle detection changes preserve existing behavior for include-based cycles.
- Check diagnostic readability and duplication handling.
- Validate determinism of graph traversal and logging with/without cycles.
</reviewer>
<tests>
- pytest tests/discovery/test_real_world_regressions.py::test_recursive_make_backedge_flags_cycle
- pytest -k cycle and discovery
- Manual: gmake2cmake --source-dir <git clone>/t --dry-run --report -vv
</tests>
</task>
