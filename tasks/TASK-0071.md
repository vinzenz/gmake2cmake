<task id="TASK-0071">
<summary>Enrich JSON diagnostics with source line context for investigation</summary>
<scope>
- Components: diagnostics serialization/reporting (JSON and markdown), CLI report generation
- Scenarios: discovery errors (include/read/subdir) should expose the originating line text to speed real-world triage (e.g., OpenSSL generated Makefile dependency lists)
</scope>
<developer>
- Extend diagnostic payloads to include the failing line content (and optionally column hints) when a file-backed location is available; avoid breaking existing consumers.
- Ensure discovery, parser, and evaluation codepaths supply enough context (path + line) so reporters can fetch the line text safely via FileSystemAdapter without extra I/O churn.
- Update JSON schema/structure documentation and markdown report to surface the new field in a readable way.
- Keep serialization deterministic and backward compatible (e.g., gated behind a versioned field name).
</developer>
<qe>
- Add regression verifying JSON reports capture the offending line for a discovery include/read error using FakeFS fixtures.
- Validate behavior when the file is missing or unreadable (line content omitted but diagnostic remains).
- Run end-to-end CLI dry-run to confirm reports still parse and tooling does not regress.
</qe>
<reviewer>
- Check that additional reads are bounded (no performance regression on large projects).
- Confirm the new field is documented and does not break existing report consumers.
- Ensure error handling for missing files is graceful and deterministic.
</reviewer>
<tests>
- pytest -k "report and diagnostics"
- pytest tests/discovery/test_real_world_regressions.py (to ensure no breakage)
- Smoke: gmake2cmake --dry-run --report on a fixture with injected errors; inspect report.json line context field.
</tests>
</task>
