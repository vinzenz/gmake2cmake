<task id="TASK-0067">
<summary>Handle computed dependency includes to reduce DISCOVERY_INCLUDE_MISSING noise</summary>
<scope>
- Components: discovery.include parsing, Makefile conditional handling (ifneq/$(wildcard ...)), path normalization
- Scenarios: Git dep_files_present wildcard include; BusyBox dependency prereqs encoded as include/autoconf.h rule trailing $(wildcard ...)
</scope>
<developer>
- Treat include targets guarded by $(wildcard ...) or conditional blocks as optional when the expansion is empty; avoid emitting missing include errors for placeholders like $(dep_files_present).
- Tighten detection so rule targets beginning with "include/" do not get misinterpreted as include directives; require directive + whitespace.
- Normalize tokens to drop trailing ":" and pipeline "|" separators before resolving paths.
- Add guardrails to avoid recording edges for obviously invalid tokens ($(wildcard, $(srctree)/*/*.c), etc.).
- Provide structured diagnostic metadata indicating whether the include was gated by a condition or wildcard.
</developer>
<qe>
- Extend regression coverage for wildcard-gated includes (dep_files_present) and kbuild-style autoconf prerequisites.
- Validate that optional includes still warn while gated includes do not raise hard errors when files are absent.
- Check diagnostics remain deterministic and deduplicated when multiple tokens collapse to the same missing path.
</qe>
<reviewer>
- Ensure parsing changes do not break standard include handling or optional include warnings.
- Confirm path normalization is POSIX-safe and does not introduce false positives.
- Verify diagnostic severity choices are justified and documented.
</reviewer>
<tests>
- pytest tests/discovery/test_real_world_regressions.py::test_conditional_wildcard_includes_reported_missing
- pytest tests/discovery/test_real_world_regressions.py::test_kbuild_autoconf_rule_misparsed_and_read_fails
- pytest -k discovery and wildcard
</tests>
</task>
