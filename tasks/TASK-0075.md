<task id="TASK-0075">
<summary>Reconcile introspected data with static IR and surface mismatches</summary>
<scope>
- Components: IRBuilder merge logic, diagnostics (`INTROSPECTION_MISMATCH`), UnknownConstruct handling
- Behavior: compare static analysis results with make-introspection data, prefer introspection by default, annotate IR
</scope>
<developer>
- Add merge layer that, for each IR target, compares deps/commands/flags from static analysis vs introspection; mark targets as validated when they match.
- When differences exist, prefer introspection data (configurable placeholder), emit `INTROSPECTION_MISMATCH` diagnostic capturing deltas.
- Create IR targets for introspection-only entries (origin=introspection) while retaining UnknownConstructs from static failures.
- Ensure deterministic ordering and deduplication; preserve static UnknownConstructs even when introspection fills gaps.
- Expose counters for validated/modified/mismatched targets for reporting.
</developer>
<qe>
- Add unit tests covering: match case (validated flag set), mismatch with diagnostic, introspection-only target creation, and coexistence with UnknownConstructs.
- Integration test tying parser + merge layer to assert IR changes reflect introspection preference.
- Verify diagnostics serialize correctly and no duplicate entries on repeated runs.
</qe>
<reviewer>
- Confirm merge rules align with feature request and remain configurable for future policies.
- Ensure no regressions to static-only flows when introspection is disabled.
- Check determinism and clarity of mismatch diagnostics (specific deltas).
</reviewer>
<tests>
- pytest tests/introspection/test_reconciliation.py
- pytest -k INTROSPECTION_MISMATCH
- End-to-end: new e2e fixture exercising merge path
</tests>
</task>
